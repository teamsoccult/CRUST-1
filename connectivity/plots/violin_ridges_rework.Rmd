---
title: "Untitled"
author: "Victor MÃ¸ller"
date: "20 maj 2019"
output: html_document
---

packages & working directory. 

```{r}

library(pacman)
p_load(readr, tidyverse, ggplot2, RColorBrewer, reshape2, ggthemes,
       viridis, ggridges, ggunchained, rlang)



```

loading data (come back)

```{r}

#working directory. 
setwd("~/CRUST-1/data/tests")
path = "~/CRUST-1/data/tests/"
files <- list.files(path = path, pattern="*csv")

#taken from the scatter-plot file (reconsider what is needed)
mycols <- c("replica", 
            "turn", 
            "studies", 
            "network", 
            "colab_cond",
            "population", 
            "sigma",
            "net_size",
            "base_SS",
            "true_model",
            "strategy",
            "switch_rep_study",
            "switch_rep",
            "prop_true",
            "final_g_true")

#loading them 
dfList <- lapply(files, function(f) {  
   read.csv(paste0(path, f))[mycols]
})

#subsetting (because of computational demands)
df <- do.call(rbind, dfList) 
rm(list=setdiff(ls(), "df"))

```

BELOW: 
preprocessing. 
with RR for true model & by global.

```{r}

#replication rate
RR_TAT <- df %>%
  group_by(replica, network, population, sigma, true_model,
           base_SS, net_size, colab_cond) %>%
  summarize(RR = sum(switch_rep) / sum(switch_rep_study),
            TAT = mean(prop_true)) %>%
  ungroup %>%
  mutate(sample_size = ifelse(base_SS == 20, 
                              "Sample size: 20",
                              "Sample size: 100"))

#creating the grouped by (3 rows missing)
by_global <- df %>%
  group_by(final_g_true, replica, network, population, sigma, true_model,
           base_SS, net_size, colab_cond) %>%
  summarize(RR = sum(switch_rep) / sum(switch_rep_study),
            TAT = mean(prop_true)) %>%
  filter(final_g_true == 1) %>%
  ungroup %>%
  mutate(sample_size = ifelse(base_SS == 20,
                              "Sample size: 20",
                              "Sample size: 100"))

#adding stuff (this is overall).
RR <- RR_TAT %>%
  mutate(final_g_true = "Overall") 

#changing stuff (this is true).
by_global$final_g_true <- "True"

#cbinding 
all_overall <- rbind(by_global, RR)

#factor. 
all_overall$final_g_true <- as.factor(all_overall$final_g_true)
all_overall$sigma <- as.factor(all_overall$sigma)
all_overall$true_model <- as.factor(all_overall$true_model)

#changing names 
all_overall <- all_overall %>%
  rename("Population" = "population", 
         "Network" = "network",
         "Sigma" = "sigma")


```

BELOW: 
(overall) Replication rate vs. time at true model. 
This is what we prep. with our melt. 
We also create a function that can be used to plot. 

```{r}

#melting
melt_RR_TAT <- melt(all_overall, id.vars = c("replica", "Population", "Sigma", "true_model", "sample_size", "final_g_true"), measure.vars = c("RR", "TAT"), variable.name = "variable", value.name = "proportion")

#for populations: 
RR_TAT_FUN <- function(melted_frame, group_var){

  group_var <- enquo(group_var)

  g <- melted_frame %>%
      filter(final_g_true == "Overall",
             sample_size == "Sample size: 20") %>%
      ggplot(aes(x = proportion, y = UQ(group_var), 
                               color = variable, fill = variable)) +
      geom_density_ridges(jittered_points = TRUE, scale = 0.8, 
                          rel_min_height = .01,
                          point_shape = "|", point_size = 3, size = 0.25, 
                          position = position_points_jitter(height = 0)) +
      scale_y_discrete(expand = c(0.01, 0)) +
      scale_x_continuous(expand = c(0,0), 
                         name = "Replication rate & time at true model") +
      scale_fill_manual(values = c("#D55E0050", "#0072B250"), 
                        labels = c("Replication rate", "Time at true model")) +
      scale_color_manual(values = c("#D55E00", "#0072B2"), guide = "none") +
      scale_discrete_manual("point_color", values = c("#D55E00", "#0072B2"), 
                            guide = "none") +
      guides(fill = guide_legend("",
        override.aes = list(
        fill = c("#D55E00A0", "#0072B2A0"),
        color = NA, point_color = NA))
      ) +
      theme_ridges(center = TRUE) + 
      theme_janco_point() 
      
    g + labs(caption = "Sample size: 100. 'Replication rate' and 'proportion of time at the true model' both on the x-axis. \n Density curves are averaged over sigma-levels, true models and replicas. \n Lines at the bottom represent mean values for individual replicas") +
      theme(plot.caption = element_text(hjust = 0.5))
}



```

Below: 
plotting with the function RR_TAT_FUN. 

```{r}

colnames(melt_RR_TAT)

RR_TAT_FUN(melt_RR_TAT, Sigma)
RR_TAT_FUN(melt_RR_TAT, Population)
RR_TAT_FUN(melt_RR_TAT, true_model)


```


Below: 
preparation for plotting of RR of TRUE/FALSE

```{r}


#melting again
RR_melt <- melt(all_overall, id.vars = c("replica", "Population", "Sigma", "true_model", "sample_size", "final_g_true"), measure.vars = c("RR"), variable.name = "variable", value.name = "proportion")

#ridges plot
RR_FUN <- function(melted_frame, group_var){
  
  group_var <- enquo(group_var)
  
g1 <- melted_frame %>%
    filter(sample_size == "Sample size: 20") %>%
    ggplot(aes(x = proportion, y = UQ(group_var),
               color = final_g_true, 
               fill = final_g_true)) +
    geom_density_ridges(jittered_points = TRUE, scale = 0.8, rel_min_height = .01,
                        point_shape = "|", point_size = 3, size = 0.25, 
                        position = position_points_jitter(height = 0)) +
    scale_y_discrete(expand = c(0.01, 0)) +
    xlim(0,1) + xlab("Replication rate") +
    scale_fill_manual(values = c("#D55E0050", "#0072B250")) +
    scale_color_manual(values = c("#D55E00", "#0072B2"), guide = "none") +
    scale_discrete_manual("point_color", values = c("#D55E00", "#0072B2"), 
                          guide = "none") +
    guides(fill = guide_legend("",
      override.aes = list(
      fill = c("#D55E00A0", "#0072B2A0"),
      color = NA, point_color = NA))) + 
    theme_ridges(center = TRUE) +
      theme_janco_point() 
    
  g1 + labs(caption = "Sample size: 20. Density curves are averaged over sigma-levels, true models and replicas. \n Lines at the bottom represent mean values for individual replicas") +
    theme(plot.caption = element_text(hjust = 0.5))

}

```

Below:
running the plots of RR

```{r}

#what you can group over
colnames(RR_melt)

#looking at the plots
RR_FUN(RR_melt, Population)
RR_FUN(RR_melt, Sigma)
RR_FUN(RR_melt, true_model)

```



Ridges plot w. true vs. overall.
Grouping by populations & averaged over everything else. 
At the moment it groups by sample size (not sure whether we keep this). 

```{r}


```


