---
title: "Untitled"
author: "Victor MÃ¸ller"
date: "20 maj 2019"
output: html_document
---

packages & working directory. 

```{r}
library(pacman)
p_load(readr, tidyverse, ggplot2, RColorBrewer, reshape2, ggthemes)

#working directory. 
setwd("C:/Users/victm/Dropbox/CogSci 4/Social and Cultural Dynamics in Cognition/exam/CRUST-1/data/ABMdata/ABMcsv")
```

loading data. 

```{r}

#reading 
path <- "C:/Users/victm/Dropbox/CogSci 4/Social and Cultural Dynamics in Cognition/exam/CRUST-1/data/ABMdata/ABMcsv/"

files <- list.files(path = path, pattern="*.csv") #if possible. 

#taken from the scatter-plot file (reconsider what is needed)
mycols <- c("replica", 
            "turn", 
            "studies", 
            "network", 
            "population", 
            "sigma",
            "sample_size",
            "true_model",
            "strategy",
            "edges_replication_study",
            "edges_replicated",
            "proportion_true")

#loading them 
dfList <- lapply(files, function(f) {  
   read.csv(paste0(path, f))[mycols]
})

#subsetting (because of computational demands)
df <- do.call(rbind, dfList) 
rm(dfList)
```

Preprocessing (should also be adjusted to accommodate better early prep). 

```{r}

#replication rate small world 
small_RR <- small %>%
  group_by(replica, network, population, sigma, true_model) %>%
  summarize(RR = sum(edges_replicated) / 
              sum(edges_replication_study)) 

#replication rate lattice
lattice_RR <- lattice %>%
  group_by(replica, network, population, sigma, true_model) %>%
  summarize(RR = sum(edges_replicated) /
              sum(edges_replication_study))
```

grouping for plotting 

```{r}

#combining them 
total_RR <- rbind(lattice_RR, small_RR)
total_RR$network <- as.factor(total_RR$network)
total_RR$true_model <- as.factor(total_RR$true_model)
str(total_RR)

```

raincloud prep

```{r}

#preparing raincloud (can be customized)
raincloud_theme = theme(
text = element_text(size = 10),
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
axis.text = element_text(size = 14),
axis.text.x = element_text(vjust = 0.5),
legend.title=element_text(size=16),
legend.text=element_text(size=16),
legend.position = "right",
plot.title = element_text(lineheight=.8, face="bold", size = 16),
panel.border = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank(),
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))

```

new directory & loading flatViolin

```{r}
setwd("C:/Users/victm/Dropbox/CogSci 4/Social and Cultural Dynamics in Cognition/exam/CRUST-1")
baseDir <- "."
scriptDir <- paste0(baseDir, "/src/functions")
inputDir <- paste0(baseDir, "/data")
outputDir <- paste0(baseDir, "/data")
source(paste0(scriptDir, "/flatViolin.R"))
```

Raincloud plot.
By inputting total_RR_sig instead we get a plot grouped by sigma & 
thus with 3 times the number of observations. 

```{r}

#raincloud plot
g <- ggplot(data = total_RR, aes(x = population, 
                                 y = RR, fill = population)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .8) +
  geom_point(aes(y = RR, color = population), 
                  position = position_jitter(width = .15), 
                  size = .5, alpha = 0.8) +
  geom_boxplot(width = .1, outlier.shape = NA, alpha = 0.5) +
  expand_limits(x = 3) +
  guides(fill = FALSE) + 
  guides(color = FALSE) +
  scale_fill_tableau() +
  scale_color_tableau() +
  #coord_flip() +
  theme_bw() +
  labs(title = "Replication rate for populations",
       x = "Population", 
       y = "Replication rate") + #sets the legend title.
  raincloud_theme

#call the plot
g

```

Raincloud plot by network type & agent population.
By inputting total_RR_sig instead we get a plot grouped by sigma & 
thus with 3 times the number of observations. 

```{r}
#raincloud plot
g <- ggplot(data = total_RR, aes(x = population, 
                                 y = RR, fill = network)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .7) +
  geom_point(aes(y = RR, color = network), 
                  position = position_jitter(width = .15), 
                  size = .5, alpha = 0.8) +
  geom_boxplot(width = .1, outlier.shape = NA, alpha = 0.5) +
  expand_limits(x = 2) + #not clear that this changes much. 
  #guides(fill = FALSE) + #legend can be deleted. 
  guides(color = FALSE) +
  scale_fill_tableau() +
  scale_color_tableau() +
  #coord_flip() +
  theme_bw() +
  labs(title = "Replication rate for populations",
       subtitle = "Grouped by network", 
       x = "Population", 
       y = "Replication rate",
       fill = "Network") + #sets the legend title.
  raincloud_theme

#call the plot
g
```

trying to group by true model. 

```{r}

#raincloud plot
g <- ggplot(data = total_RR, aes(x = population, 
                                 y = RR, fill = true_model)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .7) +
  geom_point(aes(y = RR, color = true_model), 
                  position = position_jitter(width = .15), 
                  size = .5, alpha = 0.8) +
  geom_boxplot(width = .1, outlier.shape = NA, alpha = 0.5) +
  expand_limits(x = 2) + #not clear that this changes much. 
  #guides(fill = FALSE) + #legend can be deleted. 
  guides(color = FALSE) +
  scale_fill_tableau() +
  scale_color_tableau() +
  #coord_flip() +
  theme_bw() +
  labs(title = "Replication rate for populations",
       subtitle = "By true model", 
       x = "Population", 
       y = "Replication rate",
       fill = "True model") + #sets the legend title.
  raincloud_theme

#call the plot
g
```

