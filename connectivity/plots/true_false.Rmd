---
title: "sigma plots for epi 0.5 across both networks"
author: "Mikkel Werling"
date: "5/21/2019"
output: html_document
---

```{r}
library(pacman)

p_load(igraph, stringr, ggraph, wesanderson, cowplot, caTools, data.table, permute, matrixStats, MCMCpack, tidyverse, ggunchained)
```

INTRODUCTION TO THE DOCUMENT:
1. Read data is obligatory
2. Downsampling is always recommendable, as it does not make any aesthetic difference, but significantly increases the computational load.
3. True/False plots for the individual conditions
4. Bo-plot for all the conditions with 14th and true model
5. Averaged plot of true_proportion for all the different populations 

read data

```{r}
setwd("C:/Users/Mikkel/Documents/CRUST-1/data/ABMdata/ABMcsv/Sample_size_20")

#reading 
path <- "C:/Users/Mikkel/Documents/CRUST-1/data/ABMdata/ABMcsv/Sample_size_20/"

files <- list.files(path = path, pattern="small") #if possible. 

mycols <- c("population", 
            "sigma",
            "true_model",
            "studies",
            "proportion_1",
            "proportion_2",
            "proportion_3",
            "proportion_4",
            "proportion_5",
            "proportion_6",
            "proportion_7",
            "proportion_8",
            "proportion_9",
            "proportion_10",
            "proportion_11",
            "proportion_12",
            "proportion_13",
            "proportion_14",
            "proportion_true")

#loading them 
dfList <- lapply(files, function(f) {  
   read.csv(paste0(path, f))[mycols]
})

#subsetting (because of computational demands)
df <- do.call(rbind, dfList) 
rm(dfList)
```

downsampling

```{r}

df <- df[seq(1, nrow(df), 100), ]
```

Plotting

###THINGS TO KEEP IN MIND ###
1. In order to display the different models with legend and different colors, change color to "color = variable"
2. Labels in geom_smooth does not provide labels. This is not a mistake. It just makes ggplot consider each variable as different regressions.

```{r}
naming <- colnames(df)

#IF SMALL WORLD
#df <- df %>%
  #mutate(network = "Small-world")

df <- df %>%
  melt(id = c(naming[1:4])) %>% #melting with proportions becoming variable and their values becoming values
  mutate(true_model = as.factor(true_model)) %>%
  mutate(true = ifelse(variable == "proportion_true", "True", "False")) %>% #making a identifying column in order to color for the plot
  mutate(variable = relevel(variable, ref = "proportion_true")) %>% #releveling so that proportion true is considered first
  mutate(variable = fct_rev(variable)) #releveling so that proportion true is considered last - this is done in order to make it the top layer in the overlay between different smooths.

#what you want to plot
sigma_p <- 0.2
population_p <- "Tess"
network_p <- "Small-world"
true_model_p <- 7

g <- df %>%
  filter(sigma == sigma_p, population == population_p, network == network_p, true_model == true_model_p) %>%
  ggplot(aes(studies, value, color = true))+
  geom_point(alpha = 0.01) +
  geom_smooth(method = "loess", se = F, alpha = 0.1, size = 1.2, aes(labels = variable)) +
  geom_hline(aes(yintercept = 0.5), color = "red", linetype = "dotted", size = 1) + 
  labs(x = "Studies", y = "Proportion", color = "Proportion of different models", 
       title = "Proportion of agents at the true model",
       subtitle = paste("Network:", network_p, "|", "Population:", population_p, "|", "Sigma:", sigma_p, "|", "True Model:", true_model_p)) +
  theme_janco_point()

g
```

bo plot for viweing the 14th

```{r}
naming <- colnames(df)

df <- df %>%
  melt(id = c(naming[1:4]))

df_bo <- df %>%
  filter(variable == c("proportion_true", "proportion_14"), population == "Bo") %>%
  mutate(unique_col = as.factor(paste("True Model:",true_model, "|", "Sigma:", sigma))) %>%
  mutate(variable = ifelse(variable == "proportion_true", "True Model", "Model 14"))

#what you want to plot
sigma_p <- 0.2
population_p <- "Bo"
network_p <- "Small-world"
true_model_p <- 2

g <- df_bo %>%
  ggplot(aes(studies, value, color = variable))+
  geom_point(alpha = 0.01) +
  geom_smooth(method = "loess", se = F, alpha = 0.1, size = 1.2) +
  geom_hline(aes(yintercept = 0.5), color = "red", linetype = "dotted", size = 1) + 
  labs(x = "Studies", y = "Proportion", color = "Model:") +
  facet_wrap(~unique_col) + 
  theme_janco_point()

g + labs(caption = "Sample size: 100 | Population: Bo | Downsampled by a factor 100. \n Lines are averaged over replicas. Points are raw data.") + 
  theme(plot.caption = element_text(hjust = 0.5))

```

plotting all populations

```{r}
naming <- colnames(df)

df <- df %>%
  melt(id = c(naming[1:4])) #melting with proportions becoming variable and their values becoming values


g <- df %>%
  filter(variable == "proportion_true") %>%
  ggplot(aes(studies, value, color = population))+
  geom_point(alpha = 0.01) +
  geom_smooth(method = "loess", se = F, alpha = 0.1, size = 1.4) +
  geom_hline(aes(yintercept = 0.5), color = "red", linetype = "dotted", size = 1) + 
  labs(x = "Studies", y = "Proportion", color = "Populations:") +
  theme_janco_point()

g + labs(caption = "Sample size: 20 | Downsampled by a factor 100. \n Lines are averaged over sigma-levels, true models and replicas. Points are raw data.") + 
  theme(plot.caption = element_text(hjust = 0.5))
```

