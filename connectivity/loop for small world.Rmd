---
title: "own loop"
author: "Mikkel Werling"
date: "5/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
library(pacman)
p_load(igraph, stringr, ggraph, wesanderson, cowplot)
```


paths

```{r}
baseDir <- "."
scriptDir <- paste0(baseDir, "/src/functions")
inputDir <- paste0(baseDir, "/data")
outputDir <- paste0(baseDir, "/data")
```

functions

```{r}
source(paste0(scriptDir, "/analysis.R"))
source(paste0(scriptDir, "/calculateDet.R"))
source(paste0(scriptDir, "/calculateDistance.R"))
source(paste0(scriptDir, "/compareModels.R"))
source(paste0(scriptDir, "/constants.R"))
source(paste0(scriptDir, "/convertBinary.R"))
source(paste0(scriptDir, "/generateBetas.R"))
source(paste0(scriptDir, "/generateModels.R"))
source(paste0(scriptDir, "/generateXSet.R"))
source(paste0(scriptDir, "/generateY.R"))
source(paste0(scriptDir, "/getBetas.R"))
source(paste0(scriptDir, "/getPredictors.R"))
source(paste0(scriptDir, "/modelSimilarByInteraction.R"))
source(paste0(scriptDir, "/modelSimilarByTerm.R"))
source(paste0(scriptDir, "/modelToStr.R"))
source(paste0(scriptDir, "/searchModel.R"))
source(paste0(scriptDir, "/seedGenerator.R"))
source(paste0(scriptDir, "/simulator.R"))
source(paste0(scriptDir, "/strToModel.R"))
```

input parameters

```{r}

## Number of replications
replications <- 2 #100 originally, now 2. 

## Length of the simulation
timesteps <- 11000

## Number of factors
k <- 3

## Sigma (Error variance)
sigma <- 0.2

## Sample size
sampleSize <- 100

```



```{r}
g <- sample_smallworld(1, 100, 5, 0.05) #same as our lattice, but with a rewiring probability of 0.05
 
 V(g)$name <- sample(c("Bo", "Mave", "Tess"))
 V(g)$name <- sample(V(g)$name)
 V(g)$type <- V(g)$name
 V(g)$name <- make.unique(V(g)$name)
```

Checking whether or not the adjacency matrix can be used for checking whether or not egdes of the agents can be called here

```{r}

matrix_g <- as_adjacency_matrix(g, sparse = F) #getting only the matrix from the igraph object

matrix_g["Tess.7", "Mave.7"] == 1 #are these two agents connected?

matrix_g["Mave.7", "Tess.7"] == 1 #does it work the other way around?

matrix_g <- as.matrix(matrix_g) #setting the type to matrix, just because matrix

```

Testing if a certain approach could work for the loop

```{r}
testing <- sample(V(g)$name, size = 11000, replace = T) #sampling the networks agent's names, and doing it for however many rounds we want the simulation to run

table(testing) #testing how many rounds each agents are going to have

testing[12] #arbitrarily choosing a round from the previous string

number <- which((V(g)$name == testing[12])) #figuring out what agent in the network corresponds to the one's who's currently on turn

current_type <- V(g)$type[number] #having a parameter that changes according to what type of agent is currently on turn, in order to late call upon this for choosing strategy

edgy <- names(which(matrix_g[, testing[12]] == 1)) #calling upon the previous egde-matrix, to see what agents are on turn for "bonus round"

V(g)$model <- as.factor(sample(1:14)) #giving each agent a model

V(g)$model[number] <- 13 #seeing if you can change the models of an agent

V(g)$model #you can

k = 3

models <- generateModels(k)

some_models <- NULL

N = 1

some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 

some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])
N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])
N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 

some_models[N] <- modelToStr(models[[N]])
N  <- N + 1  
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

N  <- N + 1 
some_models[N] <- modelToStr(models[[N]])

V(g)$model <- sample(some_models)

V(g)$model <- sample(V(g)$model)

model_in_format <- strToModel(V(g)$model[12], k)

#For mave

model <- models[[as.integer(runif(1, min=1, max=length(models)+1))]]

V(g)$model[number] <- modelToStr(model)

#For Tess

number <- which((V(g)$name == testing[14])) #figuring out what agent in the network corresponds to the one's who's currently on turn

current_type <- V(g)$type[number] #now a tess

modelSelection <- "soft"

model_tess <- modelSimilarByTerm(strToModel(V(g)$model[number], k), models, mode="random",
                                    modelSelection=modelSelection)

V(g)$model[number] <- model_tess

#For Bo

number <- which((V(g)$name == testing[31])) #figuring out what agent in the network corresponds to the one's who's currently on turn

current_type <- V(g)$type[number] #now a Bo

modelSelection <- "soft"

V(g)$model

bo_models <- strToModel(V(g)$model[number], k)

model_bo <- modelSimilarByInteraction(bo_models, models, mode="random",
                                    modelSelection=modelSelection)

modelSimilarByInteraction(model_in_format[3], models, mode="random",
                                    modelSelection=modelSelection)
```