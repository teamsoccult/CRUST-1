---
title: "stickiness"
author: "Mikkel Werling"
date: "5/19/2019"
output: html_document
editor_options: 
  chunk_output_type: inline
---


```{r}
#set working directory
setwd("C:/Users/victm/Dropbox/CogSci 4/Social and Cultural Dynamics in Cognition/exam/CRUST-1/data/ABMdata/ABMcsv")

#packages 
library(pacman)
p_load(tidyverse, ggunchained) 
```

loading data. 

```{r}

#reading 
path <- "C:/Users/victm/Dropbox/CogSci 4/Social and Cultural Dynamics in Cognition/exam/CRUST-1/data/ABMdata/ABMcsv/"

files <- list.files(path = path, pattern="small") #if possible. 

mycols <- c("replica", 
            "network", 
            "population", 
            "sigma",
            "true_model",
            "initial_global_true_model",
            "final_global_true_model",
            "edges_already_true",
            "edges_already_true_changing")

#loading them 
dfList <- lapply(files, function(f) {  
   read.csv(paste0(path, f))[mycols]
})

#subsetting (because of computational demands)
df <- do.call(rbind, dfList) 
rm(dfList)
```

computing stickiness.

```{r}

stickiness_index <- df %>%
  filter(initial_global_true_model == 1) %>% #only relevant subset
  group_by(replica, sigma, population, network, true_model) %>% #per replica
  summarize(stickiness = 1 - mean(as.numeric(final_global_true_model == 0))) #getting it in proportion

#summarized table
stickiness_index_summary <- stickiness_index %>%
  group_by(population, network) %>% 
  summarize(stickiness_median = median(stickiness),
            stickiness_mean = mean(stickiness),
            stickiness_IQR = IQR(stickiness)) 

#count of the different rows fulfilling the criteria (not relevant).
stickiness_count <- df %>%
  filter(initial_global_true_model == 1, final_global_true_model == 0) %>%
  group_by(population, network) %>%
  summarize(count = n())

```

relevant subsets 

```{r}

#subsetting
stickiness_lattice <- stickiness_index_summary %>%
  filter(network == "Lattice") %>%
  select(population, network, stickiness_median, stickiness_mean, stickiness_IQR)
  
stickiness_small <- stickiness_index_summary %>%
  filter(network == "Small") %>%
  select(population, network, stickiness_median, stickiness_mean, stickiness_IQR)

#checking 
head(stickiness_lattice)
head(stickiness_small)

```

write csv

```{r}
#working directory
setwd("C:/Users/victm/Dropbox/CogSci 4/Social and Cultural Dynamics in Cognition/exam/CRUST-1/connectivity/outcome_results")

#writing csv
write.csv(stickiness_lattice, "stickiness_lattice_100.csv", row.names = F)
write.csv(stickiness_small, "stickiness_small_100.csv", row.names = F)

#checking
rm(list = ls())
stickiness_lattice <- read.csv("stickiness_lattice_100.csv")
stickiness_small <- read.csv("stickiness_small_100.csv")

#checking again
head(stickiness_lattice)
head(stickiness_small)

```

