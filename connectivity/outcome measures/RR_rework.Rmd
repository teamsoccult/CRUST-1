---
title: "replication scaled"
author: "Victor MÃ¸ller"
date: "19 maj 2019"
output: html_document
---

```{r}
#set working directory
setwd("~/CRUST-1/data/tests")

#packages 
library(pacman)
p_load(tidyverse, ggunchained) 
```

loading data. 

```{r}

#reading 
path <- "~/CRUST-1/data/tests/"

files <- list.files(path = path, pattern="*.csv") #if possible. 

mycols <- c("replica", 
            "network", 
            "population", 
            "sigma",
            "net_size",
            "base_SS",
            "true_model",
            "switch_rep_study",
            "switch_rep",
            "init_g_true",
            "final_g_true",
            "prop_t_mod")

#loading them 
dfList <- lapply(files, function(f) {  
   read.csv(paste0(path, f))[mycols]
})

#subsetting (because of computational demands)
df <- do.call(rbind, dfList) 
rm(dfList)
```

replication overall 

```{r}

#replication overall 
df_overall <- df %>%
  group_by(network, population, sigma, net_size, base_SS, true_model) %>%
  summarize(replicated = sum(switch_rep) / sum(switch_rep_study),
            number = sum(switch_rep_study)) #just to check. 

# nice overview 
df_bo_13 <- df_overall %>%
  filter(population == "Bo", sigma == 0.2, true_model == 13)
```

overall summary stats

```{r}
#summary stats
df_overall_sum <- df_overall %>%
  group_by(network, population, sigma, net_size, base_SS, true_model) %>%
  summarize(RR_median = median(replicated),
            RR_mean = mean(replicated),
            RR_IQR = IQR(replicated),
            RR_SD = sd(replicated))
  #mutate(final_global_true_model = "all cases")
```

by global

```{r}

#replication if true & if not
df_byglobal <- df %>%
  group_by(prop_t_mod, network, population, sigma, net_size, base_SS, 
           true_model, net_size) %>%
  summarize(replicated = sum(switch_rep) / sum(switch_rep_study),
            number = sum(switch_rep_study)) 

min(df_byglobal$number)

```

summary stats by global 

```{r}
#replicated if true & if not (median & IQR)
df_byglobal_sum <- df_byglobal %>%
  group_by(final_global_true_model, network, population, net_size) %>%
  summarize(RR_true_median = median(replicated, na.rm = TRUE),
            RR_true_mean = mean(replicated, na.rm = TRUE),
            RR_true_IQR = IQR(replicated, na.rm = TRUE),
            RR_true_SD = sd(replicated, na.rm = TRUE)) %>%
  ungroup()

#only true 
df_true_sum <- df_byglobal_sum %>%
  filter(final_global_true_model == 1) %>%
  select(network, population, RR_true_median, RR_true_IQR, RR_true_mean, RR_true_SD)

```

write.csv

```{r}
#working directory 
setwd("~/CRUST-1/connectivity/outcome_results/sample_size_20")

#writing csv. 
write.csv(df_overall_sum, "RR_small_20.csv", row.names = F)
write.csv(df_true_sum, "RRT_small_20.csv", row.names = F)

#testing 
read.csv("RR_small_20.csv")
read.csv("RRT_small_20.csv")

#testing 
head(RR_lattice_100)
head(RR_small_100)
head(RRT_lattice_100)
head(RRT_small_100)

```
